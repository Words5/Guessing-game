<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ŸÑÿπÿ®ÿ© ÿßŸÑÿ™ÿÆŸÖŸäŸÜ</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      padding-top: 40px;
    }

    h2 {
      font-size: 32px;
      margin-bottom: 20px;
      padding: 10px 30px;
      border-radius: 12px;
      color: white;
    }

    .emojiBox {
      width: 320px;
      height: 320px;
      background: rgba(255,255,255,0.85);
      border-radius: 24px;
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      justify-content: center;
      gap: 16px;
      padding: 20px;
      overflow-y: auto;
    }

    .item {
      font-size: 48px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .item:hover {
      transform: scale(1.2);
    }

    .nameReveal {
      font-size: 28px;
      color: #444;
      animation: fadeOut 2.5s forwards;
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      70% { opacity: 1; }
      100% { opacity: 0; transform: scale(0.9); }
    }

    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99;
    }

    .resultBox {
      background: #fff;
      padding: 50px;
      border-radius: 20px;
      text-align: center;
      font-size: 32px;
      min-width: 300px;
      max-width: 90%;
      animation: popIn 0.6s ease-out;
    }

    @keyframes popIn {
      0% { transform: scale(0.3); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .winner { color: green; font-weight: bold; }
    .loser { color: crimson; font-weight: bold; }

    #restartBtn {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    #restartBtn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h2 id="title">ÿßŸÑŸÑÿπÿ®ÿ©</h2>
  <div class="emojiBox" id="itemsGrid"></div>

  <div id="overlay" class="overlay" style="display:none;">
    <div class="resultBox" id="resultBox"></div>
  </div>

  <script>
    const topic = sessionStorage.getItem("topic") || "default";
    const originalWords = JSON.parse(sessionStorage.getItem("words")) || [];
    let words = [...originalWords];

    const bgMap = {
      "fruits": "fruits.jpg",
      "food": "food.jpg",
      "flags": "flags.jpg",
      "default": "default.jpg"
    };

    const emojiMap = {
      "fruits": ["üçé", "üçå", "üçá", "üçâ", "üçí", "üçì", "üçç", "ü•≠", "üçä", "ü´ê", "üçà", "ü••", "ü´í", "üçÖ", "ü´õ", "ü•ù", "üçè", "üçã", "üçà", "üå∂Ô∏è", "ü•ï", "ü•¶", "üßÑ", "ü•î", "üåΩ", "ü•¨", "ü´ë"],
      "food": ["üçî", "üçï", "üçü", "üç´", "üçó", "üç£", "üç≥", "ü•©", "üåØ", "üçù", "üçö", "ü•ó", "üçú", "üç¶", "üç∞"],
      "flags": ["üá∏üá¶", "üá™üá¨", "üá∏üáæ", "üá©üáø", "üáÆüá∂", "üáØüá¥", "üá±üáß", "üá≤üá¶", "üáµüá∏", "üá¶üá™", "üáØüáµ", "üá∞üáº", "üá±üáæ"],
      "default": ["‚ùì"]
    };

    const titleMap = {
      "fruits": { text: "üçé ÿ≠ÿ±ÿ® ÿßŸÑŸÅŸàÿßŸÉŸá", color: "#e74c3c" },
      "food": { text: "üçî ÿ≠ÿ±ÿ® ÿßŸÑÿ£ŸÉŸÑ", color: "#f39c12" },
      "flags": { text: "üè≥Ô∏è ÿ≠ÿ±ÿ® ÿßŸÑÿ£ÿπŸÑÿßŸÖ", color: "#2980b9" },
      "default": { text: "ŸÑÿπÿ®ÿ© ÿßŸÑÿ™ÿÆŸÖŸäŸÜ", color: "#555" }
    };

    document.body.style.backgroundImage = `url('${bgMap[topic] || bgMap['default']}')`;
    document.getElementById("title").textContent = titleMap[topic]?.text || "ÿßŸÑŸÑÿπÿ®ÿ©";
    document.getElementById("title").style.backgroundColor = titleMap[topic]?.color || "#444";

    const grid = document.getElementById("itemsGrid");

    let assignedEmojis = [];

    function getRandomEmoji() {
      const list = emojiMap[topic] || emojiMap["default"];
      return list[Math.floor(Math.random() * list.length)];
    }

    function renderGrid() {
      grid.innerHTML = "";
      assignedEmojis = words.map(() => getRandomEmoji());

      words.forEach((_, i) => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = assignedEmojis[i];
        div.onclick = () => handleClick(div, i);
        grid.appendChild(div);
      });
    }

    function handleClick(div, index) {
      if (!words[index]) return;

      const name = words[index];
      div.onclick = null;
      div.innerHTML = `<div class="nameReveal">${name}</div>`;

      setTimeout(() => {
        div.remove();
        words.splice(index, 1);

        if (words.length === 1) {
          showResult("üéâ ÿßŸÑŸÅÿßÿ¶ÿ≤ ŸáŸà", words[0], "winner", true);
        } else if (words.length > 1) {
          showResult("üò¢ ÿ≠ÿ∏ ÿ£ŸàŸÅÿ±", name, "loser", false);
        }
      }, 2500);
    }

    function showResult(title, name, className, isWinner) {
      const overlay = document.getElementById("overlay");
      const resultBox = document.getElementById("resultBox");

      resultBox.innerHTML = `
        <div>${title}</div>
        <div class="${className}" style="margin-top:10px;">${name}</div>
        ${isWinner ? '<button id="restartBtn" onclick="restartGame()">ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÑÿπÿ®ÿ©</button>' : ''}
      `;
      overlay.style.display = "flex";

      if (!isWinner) {
        overlay.onclick = () => {
          overlay.style.display = "none";
          overlay.onclick = null;
        };
      }
    }

    function restartGame() {
      location.href = "index.html";
    }

    renderGrid();
  </script>
</body>
</html>
