<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ŸÑÿπÿ®ÿ© ÿßŸÑÿ™ÿÆŸÖŸäŸÜ</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      direction: rtl;
      overflow-x: hidden;
    }

    .game-title {
      text-align: center;
      font-size: 36px;
      margin: 30px 0 10px;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 3px #000;
    }

    .container {
      width: 90%;
      max-width: 900px;
      height: 500px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 20px;
      padding: 30px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 20px;
      overflow-y: auto;
    }

    .item {
      width: 100px;
      height: 100px;
      background: #f0f0f0;
      font-size: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      cursor: pointer;
      transition: transform 0.3s, opacity 1s ease-in-out;
      font-weight: bold;
    }

    .item.revealed {
      background: #fff;
      font-size: 24px;
    }

    .item.hidden {
      opacity: 0;
    }

    .popup-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .popup {
      background-color: #1a1a1a;
      padding: 60px;
      border-radius: 20px;
      color: white;
      text-align: center;
      font-size: 32px;
      max-width: 90%;
      width: 600px;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
    }

    .popup .name {
      color: #FFD700;
      font-size: 40px;
      font-weight: bold;
      margin-top: 20px;
    }

    .restart-btn {
      margin-top: 30px;
      padding: 15px 30px;
      font-size: 20px;
      background: #FFD700;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      display: none;
    }

    .restart-btn:hover {
      background: #e6c200;
    }
  </style>
</head>
<body>
  <h2 class="game-title" id="gameTitle">ÿ≠ÿ±ÿ® ÿßŸÑÿπŸÜÿßÿµÿ±</h2>
  <div class="container" id="itemsGrid"></div>

  <div class="popup-overlay" id="loseOverlay" onclick="hideLosePopup()">
    <div class="popup">
      üíî ÿ≠ÿ∏ ÿ£ŸàŸÅÿ±
      <div class="name" id="loserName"></div>
    </div>
  </div>

  <div class="popup-overlay" id="winOverlay">
    <div class="popup">
      üèÜ ÿßŸÑŸÅÿßÿ¶ÿ≤ ŸáŸà
      <div class="name" id="winnerName"></div>
      <button class="restart-btn" onclick="restartGame()">üîÅ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÑÿπÿ®ÿ©</button>
    </div>
  </div>

  <script>
    const topic = sessionStorage.getItem("topic") || "default";
    const words = JSON.parse(sessionStorage.getItem("words")) || [];

    const bgMap = {
      "fruits": "fruits.jpg",
      "food": "food.jpg",
      "flags": "flags.jpg"
    };

    const emojiMap = {
      "fruits": ["üçé", "üçå", "üçá", "üçâ", "üçí", "üçì", "üçç", "ü•≠", "üçä", "ü´ê", "üçà", "ü••", "ü´í", "üçÖ", "ü´õ", "ü•ù", "üçè", "üçã", "üå∂Ô∏è", "ü•ï", "ü•¶", "üßÑ", "ü•î", "üåΩ", "ü•¨", "ü´ë"],
      "food": ["üçî", "üçï", "üçü", "üç´", "üçó", "üç£", "üç≥", "ü•©", "üåØ", "üçù", "üçö", "ü•ó", "üçú", "üç¶", "üç∞"],
      "flags": ["üá∏üá¶", "üá™üá¨", "üá∏üáæ", "üá©üáø", "üáÆüá∂", "üáØüá¥", "üá±üáß", "üá≤üá¶", "üáµüá∏", "üá¶üá™", "üáØüáµ", "üá∞üáº", "üá±üáæ"],
      "default": ["‚ùì"]
    };

    const titleMap = {
      "fruits": "üçé ÿ≠ÿ±ÿ® ÿßŸÑŸÅŸàÿßŸÉŸá",
      "food": "üçî ÿ≠ÿ±ÿ® ÿßŸÑÿ£ŸÉŸÑ",
      "flags": "üè≥Ô∏è ÿ≠ÿ±ÿ® ÿßŸÑÿ£ÿπŸÑÿßŸÖ",
      "default": "‚ùì ŸÑÿπÿ®ÿ© ÿßŸÑÿ™ÿÆŸÖŸäŸÜ"
    };

    document.body.style.backgroundImage = `url('${bgMap[topic] || 'default.jpg'}')`;
    document.getElementById("gameTitle").textContent = titleMap[topic] || titleMap.default;

    let remainingWords = [...words];
    let usedEmojis = [];

    const grid = document.getElementById("itemsGrid");
    const emojiList = emojiMap[topic] || emojiMap["default"];

    remainingWords.forEach(word => {
      const emoji = emojiList.find(e => !usedEmojis.includes(e)) || "‚ùì";
      usedEmojis.push(emoji);

      const div = document.createElement("div");
      div.className = "item";
      div.textContent = emoji;

      div.addEventListener("click", function () {
        if (document.getElementById("loseOverlay").style.display === "flex" ||
            document.getElementById("winOverlay").style.display === "flex") return;

        const randomIndex = Math.floor(Math.random() * remainingWords.length);
        const selectedName = remainingWords.splice(randomIndex, 1)[0];
        
        div.textContent = selectedName;
        div.classList.add("revealed");

        setTimeout(() => {
          div.classList.add("hidden");
        }, 2000);

        if (remainingWords.length === 1) {
          showWinner(remainingWords[0]);
        } else {
          showLosePopup(selectedName);
        }
      });

      grid.appendChild(div);
    });

    function showLosePopup(name) {
      document.getElementById("loserName").textContent = name;
      document.getElementById("loseOverlay").style.display = "flex";
    }

    function hideLosePopup() {
      document.getElementById("loseOverlay").style.display = "none";
    }

    function showWinner(name) {
      document.getElementById("winnerName").textContent = name;
      document.getElementById("winOverlay").style.display = "flex";
      document.querySelector(".restart-btn").style.display = "inline-block";
    }

    function restartGame() {
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
