<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لعبة التخمين</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      direction: rtl;
      min-height: 100vh;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.8s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .container {
      max-width: 800px;
      margin: 50px auto;
      background: rgba(255,255,255,0.85);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0,0,0,0.2);
    }

    #itemsGrid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }

    .item {
      font-size: 64px;
      padding: 30px;
      background: #fff;
      border-radius: 16px;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .item:hover {
      transform: scale(1.1);
    }

    .fade-out {
      animation: fadeOut 2s forwards;
    }

    @keyframes fadeOut {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.8); }
    }

    .result-box {
      background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
      padding: 80px 60px;
      border-radius: 25px;
      text-align: center;
      font-size: 36px;
      font-weight: bold;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
      animation: popIn 0.5s ease-out;
      min-width: 400px;
      max-width: 90%;
      color: #333;
      z-index: 999;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .result-box span {
      display: block;
      margin-top: 30px;
      font-size: 48px;
      font-weight: bold;
    }

    .result-box.win span {
      color: #2ecc71;
      animation: winFlash 1.5s ease-in-out infinite;
    }

    .result-box.lose span {
      color: #e74c3c;
      animation: loseDrop 0.8s ease-out;
      text-shadow: 1px 1px 2px #00000033;
    }

    @keyframes popIn {
      from { transform: scale(0.8) translate(-50%, -50%); opacity: 0; }
      to { transform: scale(1) translate(-50%, -50%); opacity: 1; }
    }

    @keyframes winFlash {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.1); }
    }

    @keyframes loseDrop {
      0% { transform: translateY(-100px) scale(0.8); opacity: 0; }
      60% { transform: translateY(20px) scale(1.1); opacity: 1; }
      100% { transform: translateY(0) scale(1); }
    }

    #resetBtn {
      margin-top: 40px;
      padding: 12px 30px;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      background-color: #3498db;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #resetBtn:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>اختر الإيموجي الصحيح</h2>
    <div id="itemsGrid"></div>
    <button id="resetBtn" onclick="location.reload()">🔁 إعادة اللعبة</button>
  </div>

  <script>
    const topic = sessionStorage.getItem("topic") || "default";
    const words = JSON.parse(sessionStorage.getItem("words")) || [];

    const bgMap = {
      "fruits": "fruits.jpg",
      "planets": "planets.jpg",
      "food": "food.jpg",
      "flags": "flags.jpg"
    };

    document.body.style.backgroundImage = `url('${bgMap[topic] || 'bg_default.jpg'}')`;

    const grid = document.getElementById("itemsGrid");
    let remaining = [...words];
    let winner = words[Math.floor(Math.random() * words.length)];

    remaining.forEach((word, index) => {
      const item = document.createElement("div");
      item.className = "item";
      item.textContent = getEmoji(topic);
      item.onclick = () => handleClick(item, word);
      grid.appendChild(item);
    });

    function getEmoji(topic) {
      const emojis = {
        "fruits": "🍎",
        "planets": "🪐",
        "food": "🍔",
        "flags": "🏳️",
        "default": "❓"
      };
      return emojis[topic] || "❓";
    }

    function handleClick(element, word) {
      if (element.classList.contains("used")) return;

      element.classList.add("used");
      element.textContent = word;

      setTimeout(() => {
        element.classList.add("fade-out");

        if (word === winner) {
          showResultBox(true, word);
        } else {
          showResultBox(false, word);
        }

        setTimeout(() => {
          element.remove();
          if (word === winner) {
            grid.innerHTML = "";
          }
        }, 1800);
      }, 1600);
    }

    function showResultBox(isWinner, name) {
      const resultBox = document.createElement("div");
      resultBox.className = "result-box " + (isWinner ? "win" : "lose");
      resultBox.innerHTML = `
        <div>${isWinner ? "🎉 الفائز هو" : "💔 خرج من اللعبة"}:</div>
        <span>${name}</span>
        ${!isWinner ? "<div style='margin-top:20px;font-size:22px;'>حظاً أوفر 🌧️</div>" : ""}
      `;
      document.body.appendChild(resultBox);
    }
  </script>
</body>
</html>
