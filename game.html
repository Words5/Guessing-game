<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لعبة التخمين</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      direction: rtl;
      min-height: 100vh;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.8s ease-in-out;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background: rgba(255,255,255,0.7);
      padding: 30px;
      border-radius: 16px;
      text-align: center;
    }
    .title {
      font-size: 32px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    #itemsGrid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }
    .item {
      width: 100px;
      height: 100px;
      background: #ffffffcc;
      font-size: 40px;
      border-radius: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    .item:hover {
      transform: scale(1.1);
    }

    .result-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 0 25px rgba(0,0,0,0.3);
      z-index: 999;
      text-align: center;
      display: none;
    }
    .result-box h2 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    .winner {
      color: green;
      font-weight: bold;
      font-size: 36px;
    }
    .loser {
      color: #c0392b;
      font-size: 30px;
    }
    #restartBtn {
      margin-top: 20px;
      padding: 12px 25px;
      font-size: 18px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="gameTitle" class="title">لعبة التخمين</div>
    <div id="itemsGrid"></div>
  </div>

  <div id="resultBox" class="result-box" onclick="hideResult()">
    <h2 id="resultText"></h2>
    <div id="resultName"></div>
    <button id="restartBtn" onclick="restartGame()">🔁 إعادة اللعبة</button>
  </div>

  <script>
    const topic = sessionStorage.getItem("topic") || "default";
    const words = JSON.parse(sessionStorage.getItem("words")) || [];

    const bgMap = {
      "fruits": "fruits.jpg",
      "planets": "planets.jpg",
      "food": "food.jpg",
      "flags": "flags.jpg"
    };

    const emojiMap = {
  "fruits": ["🍎", "🍌", "🍇", "🍉", "🍒", "🍓", "🍍", "🥭", "🍊", "🫐", "🍈", "🥥", "🫒", "🍅", "🫛", "🥝", "🍏", "🍋", "🍈", "🌶️", "🥕", "🥦", "🧄", "🥔", "🌽", "🥬", "🫑"],
  "planets": ["🪐", "🌍", "🌕", "🌌", "☄️", "🌙", "🔭", "☀️", "⭐", "☁️"],
  "food": ["🍔", "🍕", "🍟", "🍫", "🍗", "🍣", "🍳", "🥩", "🌯", "🍝", "🍚", "🥗", "🍜", "🍦", "🍰"],
  "flags": ["🇸🇦", "🇪🇬", "🇸🇾", "🇩🇿", "🇮🇶", "🇯🇴", "🇱🇧", "🇲🇦", "🇵🇸", "🇦🇪", "🇯🇵", "🇰🇼", "🇱🇾"],
  "default": ["❓"]
    };

    document.body.style.backgroundImage = `url('${bgMap[topic] || 'img/bg_default.jpg'}')`;

    const grid = document.getElementById("itemsGrid");
    const shuffled = [...words].sort(() => 0.5 - Math.random());
    const target = shuffled[shuffled.length - 1];
    let remainingItems = shuffled.length;

    shuffled.forEach((word) => {
      const item = document.createElement("div");
      item.className = "item";
      item.dataset.word = word;

      const emojiList = emojiMap[topic] || emojiMap["default"];
      const randomEmoji = emojiList[Math.floor(Math.random() * emojiList.length)];
      item.innerHTML = randomEmoji;

      item.onclick = () => handleClick(item);
      grid.appendChild(item);
    });

    function handleClick(element) {
      const word = element.dataset.word;
      element.innerHTML = word;
      element.style.pointerEvents = "none";
      element.style.opacity = 0.9;

      if (word === target) {
        showResult("الفائز هو 🎉", word, true);
      } else {
        showResult("حظ أوفر 😢", word, false);
      }

      remainingItems--;
    }

    function showResult(title, name, isWinner) {
      const box = document.getElementById("resultBox");
      const text = document.getElementById("resultText");
      const nameDiv = document.getElementById("resultName");
      const restartBtn = document.getElementById("restartBtn");

      text.textContent = title;
      nameDiv.textContent = name;
      nameDiv.className = isWinner ? "winner" : "loser";

      box.style.display = "block";
      restartBtn.style.display = isWinner ? "inline-block" : "none";

      if (!isWinner && remainingItems > 1) {
        setTimeout(() => {
          box.style.display = "none";
        }, 2000);
      }
    }

    function hideResult() {
      const box = document.getElementById("resultBox");
      box.style.display = "none";
    }

    function restartGame() {
      location.reload();
    }

    // Show game title based on category
    const titles = {
      "fruits": "🍎 حرب الفواكه",
      "planets": "🪐 حرب الكواكب",
      "food": "🍔 حرب الأكل",
      "flags": "🏳️ حرب الأعلام",
      "default": "❓ لعبة التخمين"
    };
    document.getElementById("gameTitle").textContent = titles[topic] || titles["default"];
  </script>
</body>
</html>
